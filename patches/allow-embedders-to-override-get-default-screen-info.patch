Description: Allow embedders to override RenderWidgetHostViewPort::GetDefaultScreenInfo
 This modifies the Aura implementation of RWHVP::GetDefaultScreenInfo so that it
 can delegate to embedders, rather than using Aura / X11 to do this
Author: Chris Coulson <chris.coulson@canonical.com>

diff --git a/content/browser/renderer_host/render_widget_host_view_aura.cc b/content/browser/renderer_host/render_widget_host_view_aura.cc
--- a/content/browser/renderer_host/render_widget_host_view_aura.cc
+++ b/content/browser/renderer_host/render_widget_host_view_aura.cc
@@ -3362,12 +3362,13 @@ void RenderWidgetHostViewAura::DetachFro
 // static
 RenderWidgetHostView* RenderWidgetHostView::CreateViewForWidget(
     RenderWidgetHost* widget) {
   return new RenderWidgetHostViewAura(widget);
 }
 
 // static
 void RenderWidgetHostViewPort::GetDefaultScreenInfo(WebScreenInfo* results) {
-  GetScreenInfoForWindow(results, NULL);
+  if (!RenderWidgetHostViewBase::GetDefaultScreenInfo(results))
+    GetScreenInfoForWindow(results, NULL);
 }
 
 }  // namespace content
diff --git a/content/browser/renderer_host/render_widget_host_view_base.cc b/content/browser/renderer_host/render_widget_host_view_base.cc
--- a/content/browser/renderer_host/render_widget_host_view_base.cc
+++ b/content/browser/renderer_host/render_widget_host_view_base.cc
@@ -8,16 +8,18 @@
 #include "content/browser/accessibility/browser_accessibility_manager.h"
 #include "content/browser/gpu/gpu_data_manager_impl.h"
 #include "content/browser/renderer_host/basic_mouse_wheel_smooth_scroll_gesture.h"
 #include "content/browser/renderer_host/input/synthetic_gesture_target_base.h"
 #include "content/browser/renderer_host/render_process_host_impl.h"
 #include "content/browser/renderer_host/render_widget_host_impl.h"
 #include "content/port/browser/render_widget_host_view_frame_subscriber.h"
 #include "content/port/browser/synthetic_gesture.h"
+#include "content/public/browser/content_browser_client.h"
+#include "content/public/common/content_client.h"
 #include "third_party/WebKit/public/platform/WebScreenInfo.h"
 #include "ui/gfx/display.h"
 #include "ui/gfx/screen.h"
 #include "ui/gfx/size_conversions.h"
 #include "ui/gfx/size_f.h"
 
 #if defined(OS_WIN)
 #include "base/command_line.h"
@@ -380,16 +382,22 @@ void RenderWidgetHostViewBase::DetachPlu
 
 namespace {
 
 // How many microseconds apart input events should be flushed.
 const int kFlushInputRateInUs = 16666;
 
 }
 
+// static
+bool RenderWidgetHostViewBase::GetDefaultScreenInfo(
+    blink::WebScreenInfo* result) {
+  return GetContentClient()->browser()->GetDefaultScreenInfo(result);
+}
+
 RenderWidgetHostViewBase::RenderWidgetHostViewBase()
     : popup_type_(blink::WebPopupTypeNone),
       mouse_locked_(false),
       showing_context_menu_(false),
       selection_text_offset_(0),
       selection_range_(gfx::Range::InvalidRange()),
       current_device_scale_factor_(0),
       renderer_frame_number_(0) {
diff --git a/content/browser/renderer_host/render_widget_host_view_base.h b/content/browser/renderer_host/render_widget_host_view_base.h
--- a/content/browser/renderer_host/render_widget_host_view_base.h
+++ b/content/browser/renderer_host/render_widget_host_view_base.h
@@ -20,16 +20,20 @@
 #include "base/callback_forward.h"
 #include "base/timer/timer.h"
 #include "content/common/content_export.h"
 #include "content/port/browser/render_widget_host_view_port.h"
 #include "ui/gfx/native_widget_types.h"
 #include "ui/gfx/range/range.h"
 #include "ui/gfx/rect.h"
 
+namespace blink {
+class WebScreenInfo;
+}
+
 namespace content {
 
 class RenderWidgetHostImpl;
 
 // Basic implementation shared by concrete RenderWidgetHostView
 // subclasses.
 //
 // Note that nothing should use this class, except concrete subclasses
@@ -103,16 +107,18 @@ class CONTENT_EXPORT RenderWidgetHostVie
   bool HasDisplayPropertyChanged(gfx::NativeView view);
 
 #if defined(OS_WIN)
   // The callback that DetachPluginsHelper calls for each child window. Call
   // this directly if you want to do custom filtering on plugin windows first.
   static void DetachPluginWindowsCallback(HWND window);
 #endif
 
+  static bool GetDefaultScreenInfo(blink::WebScreenInfo* results);
+
  protected:
   // Interface class only, do not construct.
   RenderWidgetHostViewBase();
 
 #if defined(OS_WIN)
   // Shared implementation of MovePluginWindows for use by win and aura/wina.
   static void MovePluginWindowsHelper(
       HWND parent,
diff --git a/content/public/browser/content_browser_client.cc b/content/public/browser/content_browser_client.cc
--- a/content/public/browser/content_browser_client.cc
+++ b/content/public/browser/content_browser_client.cc
@@ -283,16 +283,21 @@ ui::SelectFilePolicy* ContentBrowserClie
     WebContents* web_contents) {
   return NULL;
 }
 
 LocationProvider* ContentBrowserClient::OverrideSystemLocationProvider() {
   return NULL;
 }
 
+bool ContentBrowserClient::GetDefaultScreenInfo(
+    blink::WebScreenInfo* result) {
+  return false;
+}
+
 #if defined(OS_WIN)
 const wchar_t* ContentBrowserClient::GetResourceDllName() {
   return NULL;
 }
 #endif
 
 #if defined(USE_NSS)
 crypto::CryptoModuleBlockingPasswordDelegate*
diff --git a/content/public/browser/content_browser_client.h b/content/public/browser/content_browser_client.h
--- a/content/public/browser/content_browser_client.h
+++ b/content/public/browser/content_browser_client.h
@@ -31,16 +31,17 @@
 #include "base/posix/global_descriptors.h"
 #endif
 
 class CommandLine;
 class GURL;
 struct WebPreferences;
 
 namespace blink {
+class WebScreenInfo;
 struct WebWindowFeatures;
 }
 
 namespace base {
 class DictionaryValue;
 class FilePath;
 }
 namespace crypto {
@@ -566,16 +567,19 @@ class CONTENT_EXPORT ContentBrowserClien
       BrowserContext* browser_context,
       const base::FilePath& storage_partition_path,
       ScopedVector<fileapi::FileSystemBackend>* additional_backends) {}
 
   // Allows an embedder to return its own LocationProvider implementation.
   // Return NULL to use the default one for the platform to be created.
   virtual LocationProvider* OverrideSystemLocationProvider();
 
+  // Allows an embedder to override RenderViewHostPort::GetDefaultScreenInfo
+  virtual bool GetDefaultScreenInfo(blink::WebScreenInfo* result);
+
 #if defined(OS_POSIX) && !defined(OS_MACOSX)
   // Populates |mappings| with all files that need to be mapped before launching
   // a child process.
   virtual void GetAdditionalMappedFilesForChildProcess(
       const CommandLine& command_line,
       int child_process_id,
       std::vector<FileDescriptorInfo>* mappings) {}
 #endif

# Description: Allow the embedder to override the renderer compositor
#  settings
# Author: Chris Coulson <chris.coulson@canonical.com>

diff --git a/content/public/renderer/content_renderer_client.cc b/content/public/renderer/content_renderer_client.cc
--- a/content/public/renderer/content_renderer_client.cc
+++ b/content/public/renderer/content_renderer_client.cc
@@ -218,9 +218,12 @@ std::string ContentRendererClient::GetUs
 blink::WebMediaPlayer* ContentRendererClient::OverrideWebMediaPlayer(
     blink::WebFrame* frame,
     blink::WebMediaPlayerClient* client,
     base::WeakPtr<media::WebMediaPlayerDelegate> delegate,
     media::MediaLog* media_log) {
   return nullptr;
 }
 
+void ContentRendererClient::OverrideCompositorSettings(
+    cc::LayerTreeSettings* settings) {}
+
 }  // namespace content
diff --git a/content/public/renderer/content_renderer_client.h b/content/public/renderer/content_renderer_client.h
--- a/content/public/renderer/content_renderer_client.h
+++ b/content/public/renderer/content_renderer_client.h
@@ -49,16 +49,20 @@ class WebSpeechSynthesizer;
 class WebSpeechSynthesizerClient;
 class WebThemeEngine;
 class WebURLRequest;
 class WebWorkerPermissionClientProxy;
 struct WebPluginParams;
 struct WebURLError;
 }
 
+namespace cc {
+class LayerTreeSettings;
+}
+
 namespace media {
 class MediaLog;
 class RendererFactory;
 class WebMediaPlayerDelegate;
 struct KeySystemInfo;
 }
 
 namespace content {
@@ -299,13 +303,16 @@ class CONTENT_EXPORT ContentRendererClie
   virtual std::string GetUserAgentOverrideForURL(const GURL& url);
 
   // Allow overriding default media player
   virtual blink::WebMediaPlayer* OverrideWebMediaPlayer(
       blink::WebFrame* frame,
       blink::WebMediaPlayerClient* client,
       base::WeakPtr<media::WebMediaPlayerDelegate> delegate,
       media::MediaLog* media_log);
+
+  // Allow overriding the renderer compositor settings
+  virtual void OverrideCompositorSettings(cc::LayerTreeSettings* settings);
 };
 
 }  // namespace content
 
 #endif  // CONTENT_PUBLIC_RENDERER_CONTENT_RENDERER_CLIENT_H_
diff --git a/content/renderer/gpu/render_widget_compositor.cc b/content/renderer/gpu/render_widget_compositor.cc
--- a/content/renderer/gpu/render_widget_compositor.cc
+++ b/content/renderer/gpu/render_widget_compositor.cc
@@ -26,17 +26,19 @@
 #include "cc/output/begin_frame_args.h"
 #include "cc/output/copy_output_request.h"
 #include "cc/output/copy_output_result.h"
 #include "cc/resources/single_release_callback.h"
 #include "cc/scheduler/begin_frame_source.h"
 #include "cc/trees/layer_tree_host.h"
 #include "content/common/content_switches_internal.h"
 #include "content/common/gpu/client/context_provider_command_buffer.h"
+#include "content/public/common/content_client.h"
 #include "content/public/common/content_switches.h"
+#include "content/public/renderer/content_renderer_client.h"
 #include "content/renderer/input/input_handler_manager.h"
 #include "content/renderer/scheduler/renderer_scheduler.h"
 #include "gpu/command_buffer/client/gles2_interface.h"
 #include "third_party/WebKit/public/platform/WebCompositeAndReadbackAsyncCallback.h"
 #include "third_party/WebKit/public/platform/WebSelectionBound.h"
 #include "third_party/WebKit/public/platform/WebSize.h"
 #include "third_party/WebKit/public/web/WebKit.h"
 #include "third_party/WebKit/public/web/WebRuntimeFeatures.h"
@@ -434,16 +436,18 @@ void RenderWidgetCompositor::Initialize(
       compositor_deps_->GetGpuMemoryBufferManager();
 
   scoped_ptr<cc::BeginFrameSource> external_begin_frame_source;
   if (settings.use_external_begin_frame_source) {
     external_begin_frame_source =
         compositor_deps_->CreateExternalBeginFrameSource(widget_->routing_id());
   }
 
+  GetContentClient()->renderer()->OverrideCompositorSettings(&settings);
+
   if (compositor_thread_task_runner.get()) {
     layer_tree_host_ = cc::LayerTreeHost::CreateThreaded(
         this, shared_bitmap_manager, gpu_memory_buffer_manager, settings,
         main_thread_compositor_task_runner, compositor_thread_task_runner,
         external_begin_frame_source.Pass());
   } else {
     layer_tree_host_ = cc::LayerTreeHost::CreateSingleThreaded(
         this, this, shared_bitmap_manager, gpu_memory_buffer_manager, settings,
